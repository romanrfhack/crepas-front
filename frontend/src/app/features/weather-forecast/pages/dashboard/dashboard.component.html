<div class="dashboard-page">
  <!-- HEADER -->
  <header class="page-header">
    <h2>ğŸ“Š Dashboard</h2>
    <p class="page-subtitle">Bienvenido al panel de control</p>
    <div class="header-decoration"></div>
  </header>

  <!-- FILTROS -->
  <div class="section-card" data-testid="dashboard-filters-card">
    <div class="section-header">
      <span class="section-icon">ğŸ—“ï¸</span>
      <h3>Filtros</h3>
    </div>
    <div class="filters-grid">
      <!-- PerÃ­odo -->
      <label for="dashboard-period-select">
        PerÃ­odo
        <select
          id="dashboard-period-select"
          [value]="selectedPeriod()"
          (change)="onPeriodSelectChange($event)"
          data-testid="dashboard-period-select"
        >
          <option value="today">Hoy</option>
          <option value="week">Esta semana</option>
          <option value="month">Este mes</option>
          <option value="custom">Personalizado</option>
        </select>
      </label>

      <!-- Cajero -->
      <label for="dashboard-cashier-select">
        Cajero
        <select
          id="dashboard-cashier-select"
          [value]="selectedCashierId()"
          (change)="onCashierSelectChange($event)"
          data-testid="dashboard-cashier-select"
        >
          <option value="">Todos</option>
          @for (cashier of cashiers(); track cashier.cashierUserId) {
            <option [value]="cashier.cashierUserId">{{ cashier.userName }}</option>
          }
        </select>
      </label>

      <!-- Fechas custom -->
      @if (isCustomPeriod()) {
        <label for="dashboard-date-from">
          Desde
          <input
            id="dashboard-date-from"
            type="date"
            [value]="customDateFrom()"
            (input)="onCustomDateFromInput($event)"
            data-testid="dashboard-date-from"
          />
        </label>

        <label for="dashboard-date-to">
          Hasta
          <input
            id="dashboard-date-to"
            type="date"
            [value]="customDateTo()"
            (input)="onCustomDateToInput($event)"
            data-testid="dashboard-date-to"
          />
        </label>
      }
    </div>

    <!-- Errores -->
    @if (cashierError()) {
      <p class="error" role="alert" data-testid="dashboard-cashier-error">{{ cashierError() }}</p>
    }
    @if (customDateError(); as error) {
      <p class="error" role="alert" data-testid="dashboard-custom-date-error">{{ error }}</p>
    }
  </div>

  <!-- INDICADOR DE CARGA GLOBAL (opcional) -->
  @if (loadingKpis() || loadingPayments() || loadingTopProducts() || loadingHourlySales()) {
    <div class="flex justify-center items-center py-10 text-gray-500">
      <span class="material-icons animate-spin mr-2">refresh</span>
      Cargando datos...
    </div>
  }

  <!-- KPIS (nuevo estilo) -->
  <div class="section-card" data-testid="dashboard-kpis-card">
    <div class="section-header">
      <span class="section-icon">ğŸ“Š</span>
      <h3>MÃ©tricas clave</h3>
    </div>

    @if (kpisError()) {
      <p class="error" role="alert" data-testid="dashboard-kpis-error">{{ kpisError() }}</p>
    }

    @if (!loadingKpis() && !kpisError() && kpis()) {
      <div class="kpi-grid">
        <!-- Ventas totales -->
        <div class="kpi-card" data-testid="dashboard-kpi-gross-sales">
          <div class="kpi-header">
            <h4>Ventas totales</h4>
            <span class="kpi-header-icon">ğŸ’°</span>
          </div>
          <div class="kpi-content">
            <div class="kpi-icon-circle" style="background-color: #e89aac;">
              ğŸ’°
            </div>
            <div class="kpi-numbers">
              <div class="kpi-main-value">{{ kpis()?.grossSales | currency:'MXN':'symbol':'1.2-2' }}</div>
              <!-- Tendencia opcional (pendiente) -->
            </div>
          </div>
        </div>

        <!-- Tickets -->
        <div class="kpi-card" data-testid="dashboard-kpi-tickets">
          <div class="kpi-header">
            <h4>Tickets</h4>
            <span class="kpi-header-icon">ğŸ§¾</span>
          </div>
          <div class="kpi-content">
            <div class="kpi-icon-circle" style="background-color: #6b3f2a;">
              ğŸ§¾
            </div>
            <div class="kpi-numbers">
              <div class="kpi-main-value">{{ kpis()?.tickets ?? 0 }}</div>
            </div>
          </div>
        </div>

        <!-- Ticket promedio -->
        <div class="kpi-card" data-testid="dashboard-kpi-avg-ticket">
          <div class="kpi-header">
            <h4>Ticket promedio</h4>
            <span class="kpi-header-icon">ğŸ“ˆ</span>
          </div>
          <div class="kpi-content">
            <div class="kpi-icon-circle" style="background-color: #c98d6a;">
              ğŸ“ˆ
            </div>
            <div class="kpi-numbers">
              <div class="kpi-main-value">{{ kpis()?.avgTicket | currency:'MXN':'symbol':'1.2-2' }}</div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- GRÃFICAS (con ApexCharts) -->
  <div class="section-card">
    <div class="section-header">
      <span class="section-icon">ğŸ“‰</span>
      <h3>Reportes</h3>
      @if (effectiveDateRange(); as range) {
        <span class="count-badge">{{ range.dateFrom }} â†’ {{ range.dateTo }}</span>
      }
    </div>

    <div class="charts-grid">
      <!-- MÃ©todos de pago (dona) -->
      <div class="chart-card" data-testid="dashboard-payments-chart-card">
        <h4>MÃ©todos de pago</h4>
        @if (loadingPayments()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (paymentError()) {
          <p class="error" role="alert" data-testid="dashboard-payments-chart-error">
            {{ paymentError() }}
          </p>
        }
        @if (!loadingPayments() && !paymentError() && hasPaymentData()) {
          <div class="chart-container">
            <apx-chart
              [series]="paymentMethodChartOptions().series"
              [chart]="paymentMethodChartOptions().chart"
              [labels]="paymentMethodChartOptions().labels!"
              [colors]="paymentMethodChartOptions().colors!"
              [legend]="paymentMethodChartOptions().legend!"
              [plotOptions]="paymentMethodChartOptions().plotOptions!"
              [dataLabels]="paymentMethodChartOptions().dataLabels!"
              [responsive]="paymentMethodChartOptions().responsive!"
            ></apx-chart>
          </div>
        }
      </div>

      <!-- Top 5 productos (barras horizontales) -->
      <div class="chart-card" data-testid="dashboard-top-products-chart-card">
        <h4>Top 5 productos</h4>
        @if (loadingTopProducts()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (topProductsError()) {
          <p class="error" role="alert" data-testid="dashboard-top-products-chart-error">
            {{ topProductsError() }}
          </p>
        }
        @if (!loadingTopProducts() && !topProductsError() && hasTopProductsData()) {
          <div class="chart-container">
            <apx-chart
              [series]="topProductsChartOptions().series"
              [chart]="topProductsChartOptions().chart"
              [xaxis]="topProductsChartOptions().xaxis!"
              [yaxis]="topProductsChartOptions().yaxis!"
              [plotOptions]="topProductsChartOptions().plotOptions!"
              [dataLabels]="topProductsChartOptions().dataLabels!"
              [grid]="topProductsChartOptions().grid!"
              [colors]="topProductsChartOptions().colors!"
            ></apx-chart>
          </div>
        }
      </div>

      <!-- Ventas por hora (barras verticales) -->
      <div class="chart-card" data-testid="dashboard-hourly-sales-chart-card">
        <h4>Ventas por hora</h4>
        @if (loadingHourlySales()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (hourlySalesError()) {
          <p class="error" role="alert" data-testid="dashboard-hourly-sales-chart-error">
            {{ hourlySalesError() }}
          </p>
        }
        @if (!loadingHourlySales() && !hourlySalesError() && hasHourlySalesData()) {
          <div class="chart-container">
            <apx-chart
              [series]="hourlySalesChartOptions().series"
              [chart]="hourlySalesChartOptions().chart"
              [xaxis]="hourlySalesChartOptions().xaxis!"
              [yaxis]="hourlySalesChartOptions().yaxis!"
              [plotOptions]="hourlySalesChartOptions().plotOptions!"
              [dataLabels]="hourlySalesChartOptions().dataLabels!"
              [grid]="hourlySalesChartOptions().grid!"
              [colors]="hourlySalesChartOptions().colors!"
            ></apx-chart>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- ACCIONES RÃPIDAS (demo) -->
  <div class="section-card">
    <div class="section-header">
      <span class="section-icon">âš¡</span>
      <h3>Acciones rÃ¡pidas</h3>
    </div>
    <div class="quick-actions">
      <button type="button" class="btn-outline" disabled>ğŸ›’ Ver ventas del dÃ­a</button>
      <button type="button" class="btn-outline" disabled>ğŸ“Š Reporte semanal</button>
      <button type="button" class="btn-outline" disabled>ğŸ”” Configurar alertas</button>
      <button type="button" class="btn-outline" disabled>ğŸ‘¤ Administrar usuarios</button>
    </div>
    <div class="demo-hint">
      <span class="hint-icon">ğŸ”µ</span>
      <span>Opciones deshabilitadas en la versiÃ³n demo</span>
    </div>
  </div>
</div>