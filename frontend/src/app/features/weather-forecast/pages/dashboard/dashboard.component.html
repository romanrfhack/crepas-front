<div class="dashboard-page">
  <header class="page-header">
    <h2>&#128202; Dashboard</h2>
    <p class="page-subtitle">Bienvenido al panel de control</p>
    <div class="header-decoration"></div>
  </header>

  <div class="section-card coming-soon-card">
    <div class="coming-soon-content">
      <span class="coming-soon-icon">ğŸš§</span>
      <h3>PrÃ³ximamente</h3>
      <p class="coming-soon-text">
        Estamos trabajando para traerte un dashboard completo con mÃ©tricas en tiempo real, grÃ¡ficos
        de ventas, rendimiento de cajeros y mÃ¡s.
      </p>
      <div class="coming-soon-badge">
        <span class="badge-icon">â³</span>
        <span>Disponible en futura versiÃ³n</span>
      </div>
    </div>
  </div>

  <div class="section-card" data-testid="dashboard-filters-card">
    <div class="section-header">
      <span class="section-icon">ğŸ—“ï¸</span>
      <h3>Filtros de perÃ­odo</h3>
    </div>
    <div class="filters-grid">
      <label for="dashboard-period-select">
        PerÃ­odo
        <select
          id="dashboard-period-select"
          [value]="selectedPeriod()"
          (change)="onPeriodSelectChange($event)"
          data-testid="dashboard-period-select"
        >
          <option value="today">Hoy</option>
          <option value="week">Esta semana</option>
          <option value="month">Este mes</option>
          <option value="custom">Personalizado</option>
        </select>
      </label>

      <label for="dashboard-cashier-select">
        Cajero
        <select
          id="dashboard-cashier-select"
          [value]="selectedCashierId()"
          (change)="onCashierSelectChange($event)"
          data-testid="dashboard-cashier-select"
        >
          <option value="">Todos</option>
          @for (cashier of cashiers(); track cashier.cashierUserId) {
            <option [value]="cashier.cashierUserId">{{ cashier.userName }}</option>
          }
        </select>
      </label>

      @if (isCustomPeriod()) {
        <label for="dashboard-date-from">
          Desde
          <input
            id="dashboard-date-from"
            type="date"
            [value]="customDateFrom()"
            (input)="onCustomDateFromInput($event)"
            data-testid="dashboard-date-from"
          />
        </label>

        <label for="dashboard-date-to">
          Hasta
          <input
            id="dashboard-date-to"
            type="date"
            [value]="customDateTo()"
            (input)="onCustomDateToInput($event)"
            data-testid="dashboard-date-to"
          />
        </label>
      }
    </div>

    @if (cashierError()) {
      <p class="error" role="alert" data-testid="dashboard-cashier-error">{{ cashierError() }}</p>
    }

    @if (customDateError()) {
      <p class="error" role="alert" data-testid="dashboard-custom-date-error">
        {{ customDateError() }}
      </p>
    }
  </div>

  <div class="section-card" data-testid="dashboard-kpis-card">
    <div class="section-header">
      <span class="section-icon">ğŸ“Š</span>
      <h3>KPIs</h3>
    </div>

    @if (loadingKpis()) {
      <p class="chart-status">Cargando KPIs...</p>
    }
    @if (kpisError()) {
      <p class="error" role="alert" data-testid="dashboard-kpis-error">{{ kpisError() }}</p>
    }

    @if (!loadingKpis() && !kpisError()) {
      <div class="kpi-grid">
        <div class="kpi-card" data-testid="dashboard-kpi-gross-sales">
          <div class="kpi-icon">ğŸ’°</div>
          <div class="kpi-content">
            <span class="kpi-label">Ventas totales</span>
            <span class="kpi-value">{{
              kpis()?.grossSales ?? 0 | currency: 'MXN' : 'symbol' : '1.2-2'
            }}</span>
          </div>
        </div>
        <div class="kpi-card" data-testid="dashboard-kpi-tickets">
          <div class="kpi-icon">ğŸ§¾</div>
          <div class="kpi-content">
            <span class="kpi-label">Tickets</span>
            <span class="kpi-value">{{ kpis()?.tickets ?? 0 }}</span>
          </div>
        </div>
        <div class="kpi-card" data-testid="dashboard-kpi-avg-ticket">
          <div class="kpi-icon">ğŸ“ˆ</div>
          <div class="kpi-content">
            <span class="kpi-label">Ticket promedio</span>
            <span class="kpi-value">{{
              kpis()?.avgTicket ?? 0 | currency: 'MXN' : 'symbol' : '1.2-2'
            }}</span>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="section-card">
    <div class="section-header">
      <span class="section-icon">ğŸ“‰</span>
      <h3>Reportes reales</h3>
      @if (effectiveDateRange(); as range) {
        <span class="count-badge">{{ range.dateFrom }} â†’ {{ range.dateTo }}</span>
      }
    </div>

    <div class="charts-grid">
      <article class="chart-card" data-testid="dashboard-payments-chart-card">
        <h4>MÃ©todos de pago</h4>
        @if (loadingPayments()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (paymentError()) {
          <p class="error" role="alert" data-testid="dashboard-payments-chart-error">
            {{ paymentError() }}
          </p>
        }
        @if (!loadingPayments() && !paymentError() && hasPaymentData()) {
          <div class="chart-container" aria-label="DistribuciÃ³n de mÃ©todos de pago">
            <ngx-charts-pie-chart
              [results]="paymentMethodData()"
              [scheme]="chartColorScheme()"
              [legend]="true"
              [doughnut]="true"
              [labels]="true"
              [animations]="true"
            />
          </div>
        }
      </article>

      <article class="chart-card" data-testid="dashboard-top-products-chart-card">
        <h4>Top 5 productos</h4>
        @if (loadingTopProducts()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (topProductsError()) {
          <p class="error" role="alert" data-testid="dashboard-top-products-chart-error">
            {{ topProductsError() }}
          </p>
        }
        @if (!loadingTopProducts() && !topProductsError() && hasTopProductsData()) {
          <div class="chart-container" aria-label="Top 5 productos por venta total">
            <ngx-charts-bar-horizontal
              [results]="topProductsData()"
              [scheme]="chartColorScheme()"
              [xAxis]="true"
              [yAxis]="true"
              [showDataLabel]="true"
              [showGridLines]="true"
              [animations]="true"
              [xAxisLabel]="'Monto ($)'"
              [yAxisLabel]="'Producto'"
            />
          </div>
        }
      </article>

      <article class="chart-card" data-testid="dashboard-hourly-sales-chart-card">
        <h4>Ventas por hora</h4>
        @if (loadingHourlySales()) {
          <p class="chart-status">Cargando grÃ¡fico...</p>
        }
        @if (hourlySalesError()) {
          <p class="error" role="alert" data-testid="dashboard-hourly-sales-chart-error">
            {{ hourlySalesError() }}
          </p>
        }
        @if (!loadingHourlySales() && !hourlySalesError() && hasHourlySalesData()) {
          <div class="chart-container" aria-label="Ventas por hora en el rango de 7 dÃ­as">
            <ngx-charts-bar-vertical
              [results]="hourlySalesData()"
              [scheme]="chartColorScheme()"
              [xAxis]="true"
              [yAxis]="true"
              [showDataLabel]="true"
              [showGridLines]="true"
              [animations]="true"
              [roundDomains]="true"
              [barPadding]="14"
              [xAxisLabel]="'Hora'"
              [yAxisLabel]="'Ventas($)'"
            />
          </div>
        }
      </article>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <span class="section-icon">âš¡</span>
      <h3>Acciones rÃ¡pidas</h3>
    </div>
    <div class="quick-actions">
      <button type="button" class="btn-outline" disabled>ğŸ›’ Ver ventas del dÃ­a</button>
      <button type="button" class="btn-outline" disabled>ğŸ“Š Reporte semanal</button>
      <button type="button" class="btn-outline" disabled>ğŸ”” Configurar alertas</button>
      <button type="button" class="btn-outline" disabled>ğŸ‘¤ Administrar usuarios</button>
    </div>
    <div class="demo-hint">
      <span class="hint-icon">ğŸ”µ</span>
      <span>Opciones deshabilitadas en la versiÃ³n demo</span>
    </div>
  </div>
</div>
